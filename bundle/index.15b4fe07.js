const g=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}};g();const s={tap:new Audio("sounds/tap1.wav"),navForward:new Audio("sounds/nav1.flac"),navBackward:new Audio("sounds/nav2.flac"),refresh:new Audio("sounds/refresh.flac"),shutter:new Audio("sounds/shutter.flac")};s.tap.volume=.5;s.navForward.volume=.1;s.navBackward.volume=.2;s.shutter.volume=.05;function m(){s.tap.play()}function y(){s.refresh.play()}function b(){s.shutter.play()}function h(e=!0,t=!1){navigator.vibrate(t?20:15),e?s.navForward.play():s.navBackward.play()}var w=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",sounds:s,tap:m,refresh:y,shutter:b,navigate:h});const l={ripple(e,t=0){e.getAttribute("disabled")==null&&(p("afterclick",e,t),m())},open(e){p("afteropen",e)},land(e){p("afterland",e)}};function p(e,t,n=0){t.removeAttribute(e),setTimeout(()=>t.setAttribute(e,""),n)}S();const u={get root(){let e=new URL(document.querySelector('head > link[rel="root"]')?.getAttribute("href")??"/",location.href).pathname;return e.slice(-1)=="/"&&(e=e.slice(0,-1)),e},get pathname(){return location.pathname.replace(u.root,"")+location.search}};Object.defineProperty(location,"params",{get(){let e={};return u.pathname.split("/").forEach(t=>{const n=t.split("?")[0],i=t.split("?")[1];i&&(e={...e,[n]:decodeURIComponent(i)})}),e}});const r={get mains(){return document.querySelectorAll("body > main")},get main(){return this.mains[this.mains.length-1]},nav:document.querySelector("body > nav"),links:document.querySelectorAll("body > nav > [page]"),header:document.querySelector("body > header")},c={_bottom:"home",get values(){return[this._bottom,...u.pathname.split("/").filter(e=>e!="").map(e=>e.split("?")[0])]},push(e){history.pushState(null,"",`${location.href}/${e}`),h(!0,!0),this.apply()},get bottom(){return this.values.length==1?this._bottom:null},set bottom(e){e&&this.values.length==1&&(this._bottom=e),h(!0),this.apply()},get top(){return this.values[this.values.length-1]},get path(){return this.values.join("/")},async apply(){console.time("applystack"),console.log(`%c${this.path}`,"color: gold"),this.values.forEach(async(e,t)=>{r.mains[t]||r.main.insertAdjacentHTML("afterend","<main/>")}),r.mains.length>this.values.length?(r.main.remove(),l.land(r.main)):l.open(r.main),await k(this.top,!!this.bottom),A(this.top),console.timeEnd("applystack")}};window.stack=c;c.apply();window.onpopstate=()=>c.apply();async function A(e){document.querySelectorAll("[page]").forEach(t=>t.getAttribute("page")==e?t.setAttribute("active",""):t.removeAttribute("active"))}async function k(e,t=!0){if(!t&&r.main.children.length)return;const n=await L(`/views/${e}.html`),i=n.match(/(<main>|<main\s([\s\S]*?)>)([\s\S]*?)<\/main>/);if(i?r.main.outerHTML=i[0]:r.main.innerHTML=n,!t){const o=r.main.querySelector("header");if(!o)return;o.prepend(document.createElement("button")),o.children[0].outerHTML="<button icon navback>arrow_back</button>",o.children[0].addEventListener("click",()=>history.back())}}async function L(e){let n=await(await self.caches?.open("views"))?.match(e);return n||(r.nav.setAttribute("loading",""),n=await fetch(e),r.nav.removeAttribute("loading")),await n.text()}function S(){const e=window.fetch;window.fetch=(t,n)=>{if(t instanceof Request||!t.startsWith("/"))return e(t,n);const i=new URL(t.slice(1),location.origin+u.root+"/").href;return e(i,n)}}const v={"[ripple], [page], button, header"(e){e.addEventListener("pointerdown",()=>l.ripple(e)),e.addEventListener("keydown",t=>{t.key=="Enter"&&l.ripple(e,10)})},dialog(e){e.setAttribute("open","")},"[view]"(e){e.onclick=()=>{const t=e.getAttribute("view");!t||c.push(t)}},"[page]"(e){e.onclick=()=>{const t=e.getAttribute("page");!t||(c.bottom=t)}},textfield(e){e.setAttribute("contenteditable","");const t=async()=>e.innerText==""?e.setAttribute("empty",""):e.removeAttribute("empty");t(),e.oninput=t}};function f(e){for(const t in v)e?.matches(t)&&v[t](e);for(const t in e.children){const n=e.children[t];n.getAttribute&&f(n)}}document.querySelectorAll("body *").forEach(e=>f(e));const E=new MutationObserver(e=>e.forEach(t=>t.addedNodes.forEach(n=>n.matches&&f(n))));E.observe(document.body,{childList:!0,subtree:!0});if(navigator.serviceWorker){location.port!="3000"&&navigator.serviceWorker.register(new URL("/pwa-template/sw.js",self.location).href),navigator.serviceWorker.onmessage=t=>{t.data=="update"&&location.reload()};const e=async()=>{if(!navigator.onLine){console.warn("%cCannot update caches while offline!","color: orange");return}navigator.serviceWorker.controller?.postMessage("update")};window.updateCaches=e}window.sounds=w;
