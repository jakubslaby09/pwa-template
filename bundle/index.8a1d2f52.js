const g=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}};g();const a={tap:new Audio("sounds/tap1.wav"),navForward:new Audio("sounds/nav1.flac"),navBackward:new Audio("sounds/nav2.flac"),refresh:new Audio("sounds/refresh.flac"),shutter:new Audio("sounds/shutter.flac")};a.tap.volume=.5;a.navForward.volume=.1;a.navBackward.volume=.2;a.shutter.volume=.05;function p(){a.tap.play()}function b(){a.refresh.play()}function w(){a.shutter.play()}function f(e=!0,t=!1){navigator.vibrate(t?20:15),e?a.navForward.play():a.navBackward.play()}var y=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",sounds:a,tap:p,refresh:b,shutter:w,navigate:f});E();const c={...window.location,get root(){let e=new URL(document.querySelector('head > link[rel="root"]')?.getAttribute("href")??"/",window.location.href).pathname;return e.slice(-1)=="/"&&(e=e.slice(0,-1)),e},get pathname(){return window.location.pathname.replace(c.root,"")+window.location.search}},i={get mains(){return document.querySelectorAll("body > main")},get main(){return this.mains[this.mains.length-1]},nav:document.querySelector("body > nav"),links:document.querySelectorAll("body > nav > [page]"),header:document.querySelector("body > header")},m={async afterload(){i.main.removeAttribute("afterload"),setTimeout(()=>i.main.setAttribute("afterload",""),0)},async fullview(e=!1){e?document.body.removeAttribute("fullview"):document.body.setAttribute("fullview","")}},l={_bottom:"home",get values(){return[this._bottom,...c.pathname.split("/").filter(e=>e!="").map(e=>e.split("?")[0])]},push(e){history.pushState(null,"",`${c.href}/${e}`),f(!0,!0),this.apply()},get bottom(){return this.values.length==1?this._bottom:null},set bottom(e){e&&this.values.length==1&&(this._bottom=e),f(!0),this.apply()},get top(){return this.values[this.values.length-1]},get path(){return this.values.join("/")},async apply(){console.time("applystack"),console.log(`%c${this.path}`,"color: gold"),this.values.forEach(async(e,t)=>{i.mains[t]||i.main.insertAdjacentHTML("afterend","<main/>")}),i.mains.length>this.values.length?i.main.remove():m.afterload(),m.fullview(!!this.bottom),A(this.top),k(this.top,!!this.bottom).then(()=>console.timeEnd("applystack"))}};window.stack=l;l.apply();window.onpopstate=()=>l.apply();async function A(e){document.querySelectorAll("[page]").forEach(t=>t.getAttribute("page")==e?t.setAttribute("active",""):t.removeAttribute("active"))}async function k(e,t=!0){const o=await L(`/views/${e}.html`),s=o.match(/(<main>|<main\s([\s\S]*?)>)([\s\S]*?)<\/main>/);if(s?i.main.outerHTML=s[0]:i.main.innerHTML=o,!t){const n=i.main.querySelector("header");if(!n)return;n.prepend(document.createElement("button")),n.children[0].outerHTML="<button icon navback>arrow_back</button>",n.children[0].addEventListener("click",()=>history.back())}}async function L(e){let o=await(await self.caches?.open("views"))?.match(e);return o||(i.nav.setAttribute("loading",""),o=await fetch(e),i.nav.removeAttribute("loading")),await o.text()}function E(){const e=window.fetch;window.fetch=(t,o)=>{if(t instanceof Request||!t.startsWith("/"))return e(t,o);const s=new URL(t.slice(1),c.origin+c.root).href;return e(s,o)}}const u={ripple(e){return e.getAttribute("ripple")!=null||e.getAttribute("page")!=null||e.nodeName=="BUTTON"||e.nodeName=="HEADER"||!1},dialog(e){return e.nodeName=="DIALOG"},view(e){return!!e.getAttribute("view")},page(e){return!!e.getAttribute("page")},textfield(e){return e.nodeName=="TEXTFIELD"}},S=[{if:u.ripple,then(e){e.addEventListener("pointerdown",()=>v(e)),e.addEventListener("keydown",t=>{t.key=="Enter"&&v(e,10)})}},{if:u.dialog,then(e){e.setAttribute("open","")}},{if:u.view,then(e){e.onclick=()=>{const t=e.getAttribute("view");!t||l.push(t)}}},{if:u.page,then(e){e.onclick=()=>{const t=e.getAttribute("page");!t||(l.bottom=t)}}},{if:u.textfield,then(e){e.setAttribute("contenteditable","");const t=async()=>e.innerText==""?e.setAttribute("empty",""):e.removeAttribute("empty");t(),e.oninput=t}}];function v(e,t=0){e.getAttribute("disabled")==null&&(e.removeAttribute("afterclick"),setTimeout(()=>e.setAttribute("afterclick",""),t),p())}const T=new MutationObserver(e=>{e.forEach(t=>{t.addedNodes.forEach(o=>o.nodeName.startsWith("#")?null:h(o))})});T.observe(document.body,{childList:!0,subtree:!0});document.querySelectorAll("body *").forEach(e=>h(e));function h(e){S.forEach(t=>{t.if(e)&&t.then(e)});for(const t in e.children){const o=e.children[t];o.getAttribute&&h(o)}}if(navigator.serviceWorker){location.port!="3000"&&navigator.serviceWorker.register(new URL("/pwa-template/sw.js",self.location).href),navigator.serviceWorker.onmessage=t=>{t.data=="update"&&location.reload()};const e=async()=>{if(!navigator.onLine){console.warn("%cCannot update caches while offline!","color: orange");return}navigator.serviceWorker.controller?.postMessage("update")};window.updateCaches=e}window.sounds=y;
